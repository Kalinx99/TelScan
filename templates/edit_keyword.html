<!-- C:\Users\Anonymous\Desktop\tele\templates\edit_keyword.html -->
{% extends 'layout.html' %}

{% block content %}
<h2>编辑关键词关联</h2>
<p class="text-muted">修改关键词 <strong class="text-primary">"{{ keyword.text }}"</strong> 所关联的群组。</p>

<div class="card mt-4">
    <div class="card-body">
        <form method="POST">
            <div class="mb-3">
                <label class="form-label">选择要监控的群-组 (可多选)</label>
                <div class="mb-2">
                    <button type="button" class="btn btn-outline-secondary btn-sm" id="select-all-groups">全选</button>
                    <button type="button" class="btn btn-outline-secondary btn-sm" id="deselect-all-groups">全不选</button>
                </div>
                <div class="border rounded p-2" style="max-height: 250px; overflow-y: auto;">
                    {% for group in groups %}
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="groups" value="{{ group.id }}" id="group_{{ group.id }}"
                               {% if group.id in linked_group_ids %}checked{% endif %}>
                        <label class="form-check-label" for="group_{{ group.id }}">
                            {{ group.group_name }}
                        </label>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <button class="btn btn-primary" type="submit">保存更改</button>
            <a href="{{ url_for('keywords') }}" class="btn btn-secondary">取消</a>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const selectAllBtn = document.getElementById('select-all-groups');
    const deselectAllBtn = document.getElementById('deselect-all-groups');
    const checkboxes = document.querySelectorAll('input[name="groups"]');

    if(selectAllBtn && deselectAllBtn && checkboxes.length > 0) {
        selectAllBtn.addEventListener('click', function() {
            checkboxes.forEach(cb => cb.checked = true);
        });

        deselectAllBtn.addEventListener('click', function() {
            checkboxes.forEach(cb => cb.checked = false);
        });
    }
});
</script>

{% endblock %}
