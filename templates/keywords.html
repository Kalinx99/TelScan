<!-- C:\Users\Anonymous\Desktop\tele\templates\keywords.html -->
{% extends 'layout.html' %}

{% block content %}
<h2>关键词管理</h2>
<p class="text-muted">添加关键词，并为每个关键词指定要监控的一个或多个群组。</p>

<div class="card mt-4">
    <div class="card-body">
        <h5 class="card-title">添加新关键词</h5>
        {% if not groups %}
        <div class="alert alert-warning" role="alert">
          请先在 <a href="{{ url_for('groups') }}" class="alert-link">群组管理</a> 页面添加至少一个群组，然后才能添加关键词。
        </div>
        {% else %}
        <form method="POST">
            <div class="mb-3">
                <label for="keyword_text" class="form-label">关键词文本</label>
                <input type="text" class="form-control" name="keyword_text" id="keyword_text" placeholder="输入关键词" required>
            </div>
            <div class="mb-3">
                <label class="form-label">选择要监控的群组 (可多选)</label>
                <div class="mb-2">
                    <button type="button" class="btn btn-outline-secondary btn-sm" id="select-all-groups">全选</button>
                    <button type="button" class="btn btn-outline-secondary btn-sm" id="deselect-all-groups">全不选</button>
                </div>
                <div class="border rounded p-2" style="max-height: 150px; overflow-y: auto;">
                    {% for group in groups %}
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="groups" value="{{ group.id }}" id="group_{{ group.id }}">
                        <label class="form-check-label" for="group_{{ group.id }}">
                            {{ group.group_name }}
                        </label>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <button class="btn btn-primary" type="submit">确认添加</button>
        </form>
        {% endif %}
    </div>
</div>

<div class="card mt-4">
    <div class="card-header">
        关键词列表
    </div>
    <div class="card-body">
        {% if keywords %}
        <ul class="list-group">
            {% for keyword in keywords %}
            <li class="list-group-item">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h6 class="mb-1">{{ keyword.text }}</h6>
                        <div class="d-flex flex-wrap gap-1 mt-2">
                            {% for group in keyword.groups %}
                            <span class="badge bg-secondary">{{ group.group_name }}</span>
                            {% else %}
                            <span class="badge bg-warning text-dark">未关联任何群组</span>
                            {% endfor %}
                        </div>
                    </div>
                    <div>
                        <a href="{{ url_for('edit_keyword', keyword_id=keyword.id) }}" class="btn btn-outline-secondary btn-sm">编辑</a>
                        <a href="{{ url_for('delete_keyword', keyword_id=keyword.id) }}" class="btn btn-outline-danger btn-sm" onclick="return confirm('确定要删除吗？')">删除</a>
                    </div>
                </div>
            </li>
            {% endfor %}
        </ul>
        {% else %}
            <p class="text-center text-muted">还没有添加任何关键词。</p>
        {% endif %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const selectAllBtn = document.getElementById('select-all-groups');
    const deselectAllBtn = document.getElementById('deselect-all-groups');
    const checkboxes = document.querySelectorAll('input[name="groups"]');

    if(selectAllBtn && deselectAllBtn && checkboxes.length > 0) {
        selectAllBtn.addEventListener('click', function() {
            checkboxes.forEach(cb => cb.checked = true);
        });

        deselectAllBtn.addEventListener('click', function() {
            checkboxes.forEach(cb => cb.checked = false);
        });
    }
});
</script>
{% endblock %}
